---
title: How Azure Web Apps Hosts an ASP.NET 5 Application
abstract: ASP.NET 5 application has totally a different directory structure when you
  try to publish it and it wasn't clear for me how Azure Web Apps is actually able
  to host an ASP.NET 5 application. If you are confused on this as well, the answer
  is here.
created_at: 2015-04-12 10:13:00 +0000 UTC
tags:
- ASP.Net
- ASP.NET 5
- ASP.NET vNext
- Azure Web Apps
- Microsoft Azure
slugs:
- how-azure-web-apps-hosts-an-asp-net-5-application
---

<p>I want to write this quick post because figuring out how an <a href="http://www.asp.net/vnext">ASP.NET 5</a> application is hosted under <a href="http://azure.microsoft.com/en-gb/services/app-service/web/">Azure Web Apps</a> was a big question for me. <a href="http://gunnarpeipman.com/2014/11/asp-net-5-on-azure-websites/">Some information</a> is already there on this topic but the concept wasn’t crystal clear because when you look at the packed version of an ASP.NET 5 web application, it has the following structure on disk:</p> <p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/b4399add-8fe6-4330-9340-973ed080d701.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/896523dd-6e4b-4edc-a716-351c0688dbf2.png" width="644" height="255"></a></p> <p>It will even get more interesting when you look inside the wwwroot folder:</p> <p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/889bb172-b98a-4d37-8cd3-d6481b57a651.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/e8665ba9-5ae5-470c-adbd-f5d66d5ae53e.png" width="644" height="191"></a></p> <p>We have the static files, bin folder which only contains AspNet.Loader.dll inside it and a web.config file. The most interesting bit here is the information inside the web.config file and this information will be read by <a href="http://blogs.msdn.com/b/webdev/archive/2014/02/18/introducing-asp-net-project-helios.aspx">Helios</a>:</p> <div class="code-wrapper border-shadow-1"> <div style="color: black; background-color: white"><pre><span style="color: blue">&lt;?</span><span style="color: #a31515">xml</span> <span style="color: red">version</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">1.0</span><span style="color: black">"</span> <span style="color: red">encoding</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">utf-8</span><span style="color: black">"</span><span style="color: blue">?&gt;</span>
<span style="color: blue">&lt;</span><span style="color: #a31515">configuration</span><span style="color: blue">&gt;</span>
  <span style="color: blue">&lt;</span><span style="color: #a31515">appSettings</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">add</span> <span style="color: red">key</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">bootstrapper-version</span><span style="color: black">"</span> <span style="color: red">value</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">1.0.0-beta4-11526</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">add</span> <span style="color: red">key</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">runtime-path</span><span style="color: black">"</span> <span style="color: red">value</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">..\approot\packages</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">add</span> <span style="color: red">key</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">dnx-version" value="</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">add</span> <span style="color: red">key</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">dnx-clr" value="</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">add</span> <span style="color: red">key</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">dnx-app-base</span><span style="color: black">"</span> <span style="color: red">value</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">..\approot\src\ConfyConf.Client.Web</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
  <span style="color: blue">&lt;/</span><span style="color: #a31515">appSettings</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;/</span><span style="color: #a31515">configuration</span><span style="color: blue">&gt;</span></pre></div></div>
<p>web.config file gives us enough evidence that the wwwroot is the directory that we need to point IIS to and then Helios will read these application settings information to figure out where the application actually is, where the dependencies and packages are, etc.. Let’s deploy the application using Visual Studio Publish feature. I created a brand new Azure Web App on the fly and hit publish:</p>
<p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/095d4707-7d96-4dbc-8707-c16b411651db.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/fd3400b4-9a31-4402-930f-998175ad361e.png" width="644" height="238"></a></p>
<p>When the deployment is completed, the web site is immediately up:</p>
<p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/aaf6a32c-255c-49bd-baf0-c91a29119b72.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/1ab4dd89-7107-4bae-9e3a-05051c133f28.png" width="644" height="393"></a></p>
<p>Let’s look at how the directory structure look like after the deployment:</p>
<p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/37422e0c-9ad4-4775-ab1e-38361a28e2f9.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/9b5b4fb8-2f68-4cc2-beef-6ca34445257d.png" width="644" height="315"></a></p>
<p>Two interesting bits here are approot and wwwroot folders. The question here is that how Azure Web App knew to look into wwwroot folder. It was actually dead simple but it wasn’t obvious at the first glance. Before showing the answer, let’s have a look what IIS Express does to host an ASP.NET 5 application which will give us an hint on the answer.</p>
<p>I fired up the application through the Visual Studio to get IIS Express host my application. After the application is up, I dug into Task Manager to get the command line arguments for IIS Express:</p>
<div class="code-wrapper border-shadow-1"><pre>iisexpress.exe    10736    Running    Tugberk    00     33,804 K    33    "C:\Program Files (x86)\IIS Express\iisexpress.exe"  /config:"C:\Users\Tugberk\Documents\IISExpress\config\applicationhost.config"  /site:"WebApplication10" /apppool:"Clr4IntegratedAppPool"    IIS Express Worker Process</pre></div>
<p>This points us to applicationhost.config file and WebApplication10 site inside it. When you look at the site node for WebApplication10, you will see that some of the magic is actually happening there:</p>
<div class="code-wrapper border-shadow-1">
<div style="color: black; background-color: white"><pre><span style="color: blue">&lt;</span><span style="color: #a31515">site</span> <span style="color: red">name</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">WebApplication10</span><span style="color: black">"</span> <span style="color: red">id</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">77</span><span style="color: black">"</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">application</span> <span style="color: red">path</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">/</span><span style="color: black">"</span> <span style="color: red">applicationPool</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">Clr4IntegratedAppPool</span><span style="color: black">"</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: #a31515">virtualDirectory</span> <span style="color: red">path</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">/</span><span style="color: black">"</span> <span style="color: red">physicalPath</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">D:\apps\WebApplication10\src\WebApplication10\wwwroot</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;/</span><span style="color: #a31515">application</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: #a31515">bindings</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: #a31515">binding</span> <span style="color: red">protocol</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">http</span><span style="color: black">"</span> <span style="color: red">bindingInformation</span><span style="color: blue">=</span><span style="color: black">"</span><span style="color: blue">*:47112:localhost</span><span style="color: black">"</span> <span style="color: blue">/&gt;</span>
    <span style="color: blue">&lt;/</span><span style="color: #a31515">bindings</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;/</span><span style="color: #a31515">site</span><span style="color: blue">&gt;</span></pre></div></div>
<p>wwwroot is pointed as a virtual directory for the web application here for the root path. So, is this information helping us to see how Azure Web App is hosting our app? Absolutely! It gives us the information that something similar should be configured on Azure Web Apps side that it sees the wwwroot folder as the root. If you navigate to Configure section for your Azure Web App and scroll down to the bottom, you will see the virtual directory configuration there.</p>
<p><a href="https://tugberkugurlu.blob.core.windows.net/bloggyimages/0362b243-a503-4497-a8a6-ef28cdf4f040.png"><img title="azure-aspnet5-virtual-directory" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="azure-aspnet5-virtual-directory" src="https://tugberkugurlu.blob.core.windows.net/bloggyimages/6c6700b7-3e30-40e8-a963-e7e3eb51c167.png" width="644" height="344"></a></p>
<p>Clever! My guess is that this configuration was put there when I was publishing the Web Application through web deploy inside the Visual Studio. Digging into Web Publish Activity output could give us more information about when exactly this configuration is set.</p>  